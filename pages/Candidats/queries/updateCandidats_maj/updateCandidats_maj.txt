UPDATE public.location_candidats
SET
    nom = NULLIF({{ nom_maj.text }}::text, ''),
    mobile = NULLIF({{ mobile_maj.text }}::text, ''),
    email = NULLIF({{ email_maj.text }}::text, ''),
    garant = NULLIF({{ garant_maj.text }}::text, ''),
    chambre = NULLIF({{ chambre_maj.selectedOptionValue }}::text, ''),
    occupation = NULLIF({{ occupation_maj.text }}::text, ''),
    commentaires =NULLIF({{ commentaires_maj.text }}::text, ''), 
		decision_jp = CASE
			WHEN {{ decision_jp_maj.selectedOptionValue }}::text = '' THEN NULL
			WHEN {{ decision_jp_maj.selectedOptionValue }}::text IS NULL THEN NULL
			ELSE ({{ decision_jp_maj.selectedOptionValue }}::text)::smallint
		END,
    decision_candidat = CASE 
        WHEN {{ decision_candidat_maj.selectedOptionValue }}::text = '' THEN NULL
        WHEN {{ decision_candidat_maj.selectedOptionValue }}::text = 'true' THEN true
        WHEN {{ decision_candidat_maj.selectedOptionValue }}::text = 'false' THEN false
        ELSE decision_candidat
    END,
    statut_mobile = NULLIF({{ statut_mobile_maj.selectedOptionValue }}::text, ''),
    statut_video = NULLIF({{ statut_video_maj.selectedOptionValue }}::text, ''), 
    statut_rdv = NULLIF({{ statut_rdv_maj.selectedOptionValue }}::text, ''), 
    visale = CASE 
			WHEN {{ visale_maj.selectedOptionValue }}::text = ''  THEN NULL
			WHEN {{ visale_maj.selectedOptionValue }}::text = 'true' THEN true
			WHEN {{ visale_maj.selectedOptionValue }}::text = 'false' THEN false
			ELSE visale 
			END,  
    garant_me = CASE 
			WHEN {{ garantme_maj.selectedOptionValue }}::text = ''  IS NULL THEN NULL
			WHEN {{ garantme_maj.selectedOptionValue }}::text = 'true' THEN true
			WHEN {{ garantme_maj.selectedOptionValue }}::text = 'false' THEN false
			ELSE garant_me
			END,
		rdv = CASE 
			WHEN COALESCE({{rdv_maj.selectedOptionValue}}::text, '') = '' THEN NULL::timestamptz
			ELSE {{rdv_maj.selectedOptionValue}}::text::timestamptz 
			END,
    duree_sejour = NULLIF({{ duree_sejour_maj.text }}::text, ''), 
    debut_sejour = NULLIF({{ debut_sejour_maj.text }}::text, ''), 
    genre = NULLIF({{ genre_maj.selectedOptionValue }}::text, ''), 
    revenu = NULLIF({{ revenu_maj.text }}::text, ''), 

		orig = CASE 
			WHEN {{ orig_maj.selectedOptionValue }} = '' THEN NULL
			ELSE '{{ orig_maj.selectedOptionValue }}'::text
  		END
WHERE id_candidat = {{ appsmith.store.selectedIdCandidat }}::integer
RETURNING *;